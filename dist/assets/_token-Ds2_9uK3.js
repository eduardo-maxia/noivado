import{r as d,j as e}from"./index-Df8i59fj.js";import{u as D}from"./useQuery-BP-5wGxD.js";import{s as l}from"./supabaseClient-CmD34cSV.js";const v="videos_noivado",w=["Emocionante","EngraÃ§ado","Curto","Forte abertura","Forte fechamento"];async function U(){const{data:i,error:x}=await l.from("videos").select("id, storage_path, duration, is_vertical, has_note, created_at, selected, favorite, tags, order_index, contributor:contributors(name, relation)").order("order_index",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});if(x||!i)throw new Error("videos");const h=i.map(a=>a.storage_path).filter(Boolean),{data:n}=await l.storage.from(v).createSignedUrls(h,3600),o=new Map;return n?.forEach(a=>{a?.path&&a?.signedUrl&&o.set(a.path,a.signedUrl)}),i.map(a=>({...a,signedUrl:o.get(a.storage_path)??null}))}function F(){const{data:i,isLoading:x,isError:h,refetch:n}=D({queryKey:["admin-videos"],queryFn:U}),o=i??[],[a,b]=d.useState("Todos"),[m,y]=d.useState(null),[f,p]=d.useState(null),u=d.useMemo(()=>{const s=o.filter(t=>t.order_index!==null),r=o.filter(t=>t.order_index==null);return[...s,...r]},[o]),g=d.useMemo(()=>a==="Todos"?u:u.filter(s=>(s.tags??[]).includes(a)),[a,u]),j=d.useMemo(()=>{const s=o?.length??0,r=o?.filter(t=>t.has_note).length??0;return{total:s,withNote:r}},[o]),_=async(s,r)=>{const t=new Set(s.tags??[]);t.has(r)?t.delete(r):t.add(r),await l.from("videos").update({tags:Array.from(t)}).eq("id",s.id),await n()},T=async s=>{if(!m||m===s)return;const t=u.map(c=>c.id).filter(c=>c!==m),E=t.indexOf(s);t.splice(E,0,m),await Promise.all(t.map((c,C)=>l.from("videos").update({order_index:C}).eq("id",c))),await n()},N=async(s,r)=>{await l.from("videos").update({[r]:!s[r]}).eq("id",s.id),await n()},S=async s=>{window.confirm("Tem certeza que deseja excluir este vÃ­deo? Essa aÃ§Ã£o Ã© permanente.")&&(s.storage_path&&await l.storage.from(v).remove([s.storage_path]),await l.from("videos").delete().eq("id",s.id),p(null),await n())};return e.jsxs("main",{className:"min-h-screen bg-rose-50 text-slate-900 px-5 pb-16 pt-10",children:[e.jsxs("div",{className:"mx-auto w-full max-w-5xl space-y-8",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Painel reservado"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Use este espaÃ§o para revisar os vÃ­deos recebidos."})]}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total de vÃ­deos"}),e.jsx("p",{className:"text-2xl font-semibold",children:j.total})]}),e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total com nota escrita"}),e.jsx("p",{className:"text-2xl font-semibold",children:j.withNote})]}),e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Status geral"}),e.jsx("p",{className:"text-2xl font-semibold",children:"Em andamento"})]})]}),e.jsxs("section",{className:"rounded-2xl border border-rose-100 bg-white p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Linha do tempo"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[x&&e.jsx("p",{children:"Carregando envios..."}),o?.slice(0,6).map(s=>{const r=s.contributor;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:r?.name??"Sem nome"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"-"})]},s.id)})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`rounded-full px-4 py-2 text-sm ${a==="Todos"?"bg-rose-500 text-white":"bg-rose-100 text-rose-700"}`,onClick:()=>b("Todos"),children:"Todos"}),w.map(s=>e.jsx("button",{className:`rounded-full px-4 py-2 text-sm ${a===s?"bg-rose-500 text-white":"bg-rose-100 text-rose-700"}`,onClick:()=>b(s),children:s},s))]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700",children:"NÃ£o foi possÃ­vel carregar os vÃ­deos. Tente novamente."}),g.map(s=>{const r=Array.isArray(s.contributor)?s.contributor[0]:s.contributor;return e.jsxs("div",{draggable:!0,onDragStart:()=>y(s.id),onDragOver:t=>t.preventDefault(),onDrop:()=>T(s.id),className:"rounded-2xl border border-rose-100 bg-white p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-28 w-20 rounded-xl bg-rose-100 overflow-hidden",children:s.signedUrl?e.jsx("video",{src:s.signedUrl,muted:!0,playsInline:!0,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-rose-50"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold",children:r?.name??"Sem nome"}),e.jsx("p",{className:"text-xs text-slate-500",children:r?.relation??"RelaÃ§Ã£o nÃ£o informada"})]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:"rounded-full bg-rose-100 px-3 py-1 text-rose-700",children:["ðŸŽ¥ ",s.is_vertical?"Vertical":"Horizontal"]}),e.jsxs("span",{className:"rounded-full bg-rose-100 px-3 py-1 text-rose-700",children:["ðŸ“ ",s.has_note?"Tem nota":"Sem nota"]})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(t=>e.jsx("button",{className:`rounded-full px-3 py-1 text-xs ${(s.tags??[]).includes(t)?"bg-rose-500 text-white":"bg-rose-100 text-rose-700"}`,onClick:()=>_(s,t),children:t},t))}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-4",children:[e.jsx("button",{className:"rounded-xl bg-rose-100 py-2 text-sm text-rose-700",onClick:()=>N(s,"favorite"),children:s.favorite?"â˜… Favorito":"â˜† Favorito"}),e.jsx("button",{className:"rounded-xl bg-rose-100 py-2 text-sm text-rose-700",onClick:()=>N(s,"selected"),children:s.selected?"âœ” Selecionado":"Marcar para ediÃ§Ã£o"}),e.jsx("button",{className:"rounded-xl bg-rose-100 py-2 text-sm text-rose-700 disabled:opacity-50",onClick:()=>p(s),disabled:!s.signedUrl,children:"Ver vÃ­deo"}),e.jsx("button",{className:"rounded-xl bg-rose-50 py-2 text-sm text-rose-700 border border-rose-200",onClick:()=>S(s),children:"Excluir"})]})]},s.id)}),!x&&g.length===0&&e.jsx("p",{className:"text-sm text-slate-500",children:"Nenhum vÃ­deo por aqui."})]})]})]}),f?.signedUrl&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-3xl bg-white p-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-base font-semibold",children:"PrÃ©-visualizaÃ§Ã£o"}),e.jsx("button",{className:"text-rose-500",onClick:()=>p(null),children:"Fechar"})]}),e.jsx("video",{src:f.signedUrl,controls:!0,playsInline:!0,className:"w-full rounded-2xl bg-rose-50"})]})})]})}export{F as component};
