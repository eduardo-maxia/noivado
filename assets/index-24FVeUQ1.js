import{r as a,j as e}from"./index-CEEU5fQ7.js";import{s as y}from"./supabaseClient-CmD34cSV.js";const S=["O que faz esse casal combinar tanto?","Que conselho voc√™ daria pra essa nova fase?","Qual lembran√ßa mais bonita voc√™ tem com eles?","O que voc√™ deseja pra esse futuro juntos?","Se pudesse resumir eles em uma palavra, qual seria?","O que voc√™ mais admira nessa rela√ß√£o?","Qual momento deles te marcou mais?","Que mensagem voc√™ deixaria pra eles verem no futuro?","O que n√£o pode faltar em um relacionamento como esse?","Por que voc√™ acredita que eles formam um √≥timo casal?"],B=["Voc√™s s√£o incr√≠veis juntos","Isso vai marcar uma nova fase","Desejo toda a felicidade do mundo"],Q=80,M=30,_=120,je="videos_noivado",$=[{id:"flight",title:"Quer dar uma olhadinha onde tudo vai acontecer?",description:"Um spoilerzinho...",helper:"Foto 1 ‚Äî substituir pela imagem do avi√£o",photoLabel:"N√≥s no avi√£o",path:"/assets/aviao.jpeg"},{id:"venue-tease-1",title:"Um lugar especial esperando",description:"Um pedacinho do cen√°rio que vai guardar esse momento importante.",helper:"Foto 2 ‚Äî spoiler do lugar especial",photoLabel:"Spoiler do lugar",path:"/assets/spoiler-1.jpeg"},{id:"venue-tease-2",title:"Obrigado por fazer parte desse momento",description:"Seu v√≠deo ser√° visto apenas no momento certo. Obrigado por guardar esse carinho com a gente.",helper:"Foto 3 ‚Äî spoiler do lugar especial",photoLabel:"Outro spoiler do lugar",path:"/assets/spoiler-2.jpeg"}];function we(){const t="private_session_id",s=localStorage.getItem(t);if(s)return s;const n=crypto.randomUUID();return localStorage.setItem(t,n),n}function Ne(t){return new Promise((s,n)=>{const c=URL.createObjectURL(t),o=document.createElement("video");o.preload="metadata",o.src=c,o.onloadedmetadata=()=>{URL.revokeObjectURL(c);const d=o.videoWidth||0,l=o.videoHeight||0,m=l>=d,u=d>0?l/d:0;s({duration:o.duration||0,width:d,height:l,isVertical:m,isIdealVertical:u>=1.5})},o.onerror=()=>{URL.revokeObjectURL(c),n(new Error("N√£o foi poss√≠vel ler o v√≠deo."))}})}function ye(t){return!t||Number.isNaN(t)?"0s":`${Math.round(t)}s`}function _e(){const[t,s]=a.useState("intro"),[n,c]=a.useState("record"),[o,d]=a.useState(null),[l,m]=a.useState(null),[u,h]=a.useState(null),[p,C]=a.useState(""),[b,H]=a.useState(!1),[w,W]=a.useState(""),[k,X]=a.useState(""),[T,E]=a.useState(!1),[K,L]=a.useState(!1),[q,x]=a.useState(null),[Z,N]=a.useState(!1),[J,g]=a.useState(null),[Y,R]=a.useState(!1),[ee,I]=a.useState(0),[se,O]=a.useState(!1),F=a.useRef(null),U=a.useRef(null),v=a.useRef(null),z=a.useRef(null),V=a.useRef([]),[te,re]=a.useState(()=>S[Math.floor(Math.random()*S.length)]),[oe,ae]=a.useState(0);a.useEffect(()=>{const r=window.setInterval(()=>{ae(i=>(i+1)%B.length)},4e3);return()=>window.clearInterval(r)},[]),a.useEffect(()=>{if(!o){m(null);return}const r=URL.createObjectURL(o);return m(r),()=>URL.revokeObjectURL(r)},[o]);const D=r=>{c(r),s("guide")},ne=()=>{re(r=>{let i=r;for(let f=0;f<5;f+=1){const j=S[Math.floor(Math.random()*S.length)];if(j!==r){i=j;break}}return i})},le=()=>{v.current?.getTracks().forEach(r=>r.stop()),v.current=null,R(!1),N(!1)},ie=async()=>{if(!navigator.mediaDevices?.getUserMedia){g("C√¢mera n√£o dispon√≠vel neste dispositivo.");return}try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0});v.current=r,U.current&&(U.current.srcObject=r),g(null),R(!0)}catch{g("N√£o foi poss√≠vel abrir a c√¢mera. Tente novamente."),R(!1)}},P=async r=>{if(!r.type.startsWith("video/")){x("Envie apenas v√≠deos. Outros formatos n√£o s√£o aceitos.");return}if(r.size/(1024*1024)>Q){x(`O v√≠deo passou do limite de ${Q}MB. Escolha um arquivo menor.`);return}try{const f=await Ne(r);h(f),d(r),E(!1),x(null),s("preview")}catch{x("N√£o conseguimos preparar o v√≠deo. Tente novamente.")}},ce=()=>{F.current?.click()},de=async r=>{const i=r.target.files?.[0];i&&await P(i)},ue=()=>{if(v.current){if(!window.MediaRecorder){g("Grava√ß√£o n√£o suportada neste navegador.");return}try{V.current=[];const r=new MediaRecorder(v.current);z.current=r,r.ondataavailable=i=>{i.data.size>0&&V.current.push(i.data)},r.onstop=async()=>{const i=new Blob(V.current,{type:r.mimeType}),f=new File([i],`gravacao-${Date.now()}.webm`,{type:i.type});N(!1),await P(f)},r.start(),N(!0)}catch{g("N√£o conseguimos iniciar a grava√ß√£o."),N(!1)}}},me=()=>{z.current?.stop()},xe=()=>{d(null),h(null),m(null),E(!1),x(null),s("capture")};a.useEffect(()=>{if(t==="capture"&&n==="record"){ie();return}le()},[t,n]),a.useEffect(()=>{t==="thanks"&&(I(0),O(!1))},[t]);const he=async()=>{if(!(!o||!u)){if(!w.trim()){x("Digite seu nome para continuar."),s("info");return}if(!u.isVertical&&!T){x("Confirme que deseja enviar o v√≠deo horizontal.");return}L(!0),x(null);try{const r=we(),i=new Date().toISOString(),f=navigator.userAgent,{data:j,error:pe}=await y.from("contributors").insert({name:w.trim(),relation:k.trim()||null,session_id:r,created_at:i,user_agent:f}).select("id").single();if(pe||!j)throw new Error("contributors");const fe=o.name.split(".").pop()||"mp4",A=`${r}/${crypto.randomUUID()}.${fe}`,{error:be}=await y.storage.from(je).upload(A,o,{contentType:o.type,upsert:!1});if(be)throw new Error("upload");const{data:G,error:ge}=await y.from("videos").insert({contributor_id:j.id,storage_path:A,duration:Math.round(u.duration),is_vertical:u.isVertical,has_note:!!p.trim(),created_at:i,selected:!1,favorite:!1}).select("id").single();if(ge||!G)throw new Error("videos");if(p.trim()){const{error:ve}=await y.from("notes").insert({video_id:G.id,content:p.trim(),created_at:i});if(ve)throw new Error("notes")}s("thanks")}catch{x("Tivemos um problema ao enviar. Tente novamente quando estiver pronto.")}finally{L(!1)}}};return e.jsxs("main",{className:"min-h-screen flex flex-col items-center px-5 pb-20 pt-8",children:[e.jsx("div",{className:"landscape-warning",children:"Gire o celular para ficar em p√©"}),e.jsxs("div",{className:"w-full max-w-md space-y-6",children:[t==="intro"&&e.jsx(Se,{onRecord:()=>D("record"),onUpload:()=>D("upload")}),t==="guide"&&e.jsx(Ce,{question:te,onNewQuestion:ne,onContinue:()=>s("capture")}),t==="capture"&&e.jsx(ke,{captureMode:n,isCameraReady:Y,isRecording:Z,cameraError:J,onStartRecording:ue,onStopRecording:me,onOpenFilePicker:ce,onBack:()=>s("intro"),inputRef:F,liveVideoRef:U,onFileChange:de}),t==="preview"&&o&&u&&e.jsx(Ee,{file:o,meta:u,previewUrl:l,note:p,showNote:b,suggestion:B[oe],agreeHorizontal:T,onToggleNote:()=>H(r=>!r),onNoteChange:C,onAgreeHorizontal:E,onRetry:xe,onContinue:()=>s("info")}),t==="info"&&e.jsx(Re,{name:w,relation:k,onNameChange:W,onRelationChange:X,onContinue:()=>s("confirm"),onBack:()=>s("preview")}),t==="confirm"&&e.jsx(Ie,{name:w,relation:k,isSubmitting:K,onEdit:()=>s("info"),onSubmit:he}),t==="thanks"&&e.jsx(Oe,{slides:$,activeIndex:ee,showVideo:se,onPrev:()=>I(r=>Math.max(r-1,0)),onNext:()=>I(r=>Math.min(r+1,$.length-1)),onFinish:()=>O(!0),onCloseVideo:()=>O(!1)}),q&&e.jsx(Ue,{message:q}),t==="preview"&&u&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Recomendado entre ",M,"s e ",_,"s."]})]})]})}function Se({onRecord:t,onUpload:s}){return e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"relative overflow-hidden rounded-3xl bg-white border border-rose-100 shadow-sm",children:e.jsx("img",{src:"/assets/wedding-couple.jpeg",alt:"Casal feliz",className:"w-full h-auto"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Mensagem especial em v√≠deo"}),e.jsx("p",{className:"text-base text-slate-600",children:"Grave um recado curto e carinhoso. Este registro ser√° guardado com cuidado e s√≥ ser√° visto no momento certo."})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold shadow-lg shadow-rose-500/20",onClick:t,children:"üé• Gravar v√≠deo agora"}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-100 text-rose-700 py-4 text-lg font-semibold border border-rose-200",onClick:s,children:"üì§ Enviar v√≠deo da galeria"})]})]})}function Ce({question:t,onNewQuestion:s,onContinue:n}){return e.jsxs("section",{className:"space-y-5 h-full",children:[e.jsx("img",{src:"/assets/foto-fofa.jpeg",alt:"Foto fofa",className:"w-full aspect-square object-cover rounded-full"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"grow",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Para inspirar voc√™:"}),e.jsx("p",{className:"text-lg font-semibold",children:t}),e.jsx("button",{className:"mt-2 text-sm text-rose-500",onClick:s,children:"Ver outra ideia"})]})}),e.jsxs("div",{className:"mt-auto rounded-2xl border border-rose-100 bg-white p-4 text-slate-600 shadow-sm",children:[e.jsx("p",{className:"text-sm",children:"Grave com o celular em p√©."}),e.jsx("p",{className:"text-sm",children:"Recomendado: entre 30s e 120s."})]}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold",onClick:n,children:"Ok, vou gravar"})]})}function ke({captureMode:t,isCameraReady:s,isRecording:n,cameraError:c,onStartRecording:o,onStopRecording:d,onOpenFilePicker:l,onBack:m,inputRef:u,liveVideoRef:h,onFileChange:p}){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-3xl border border-rose-100 bg-white p-6 text-center space-y-4 shadow-sm",children:[e.jsxs("div",{className:"mx-auto h-72 w-44 rounded-3xl border-2 border-dashed border-rose-200 flex items-center justify-center text-rose-300 overflow-hidden relative",children:[t==="record"&&s?e.jsx("video",{ref:h,autoPlay:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover"}):e.jsx("span",{children:"Vertical"}),e.jsx("div",{className:"absolute bottom-2 left-2 rounded-full bg-white/80 px-3 py-1 text-xs text-rose-600",children:"Grave com o celular em p√©"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"Grave com o celular em p√© para ficar perfeito."}),t==="record"&&c&&e.jsx("p",{className:"text-sm text-rose-600",children:c})]}),t==="record"?e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold",onClick:n?d:o,disabled:!s,children:n?"Parar grava√ß√£o":"Come√ßar grava√ß√£o"}):e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold",onClick:l,children:"Escolher v√≠deo"}),t==="record"&&!s&&e.jsx("button",{className:"w-full rounded-2xl bg-rose-100 text-rose-700 py-3 text-base font-semibold",onClick:l,children:"Usar c√¢mera do aparelho"}),e.jsx("button",{className:"w-full rounded-2xl border border-rose-200 py-3 text-rose-600",onClick:m,children:"Voltar"}),e.jsx("input",{ref:u,className:"hidden",type:"file",accept:"video/*",capture:t==="record"?"user":void 0,onChange:p})]})}function Ee({file:t,meta:s,previewUrl:n,note:c,showNote:o,suggestion:d,agreeHorizontal:l,onToggleNote:m,onNoteChange:u,onAgreeHorizontal:h,onRetry:p,onContinue:C}){return e.jsxs("section",{className:"space-y-5",children:[e.jsx("div",{className:"rounded-2xl overflow-hidden border border-rose-100 bg-rose-100",children:n&&e.jsx("video",{src:n,controls:!0,playsInline:!0,className:"w-full max-h-[70vh]"})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-rose-100 bg-white px-4 py-3 text-sm text-slate-700",children:[e.jsx("span",{children:"Dura√ß√£o"}),e.jsx("span",{className:"font-semibold",children:ye(s.duration)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-rose-100 bg-white px-4 py-3 text-sm text-slate-700",children:[e.jsx("span",{children:"Formato"}),e.jsx("span",{className:`font-semibold ${s.isVertical&&s.isIdealVertical?"text-emerald-600":(s.isVertical,"text-amber-600")}`,children:s.isVertical&&s.isIdealVertical?"‚úÖ V√≠deo vertical (ideal)":s.isVertical?"‚ö†Ô∏è V√≠deo vertical (ok)":"‚ö†Ô∏è Pode n√£o ficar bom no resultado final"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-rose-100 bg-white px-4 py-3 text-sm text-slate-700",children:[e.jsx("span",{children:"Tamanho"}),e.jsxs("span",{className:"font-semibold",children:[(t.size/(1024*1024)).toFixed(1),"MB"]})]})]}),(s.duration<M||s.duration>_)&&e.jsxs("div",{className:"rounded-2xl border border-amber-400/40 bg-amber-400/10 p-4 text-sm text-amber-800",children:["Dura√ß√£o recomendada entre ",M,"s e ",_,"s."]}),!s.isVertical&&e.jsxs("label",{className:"flex items-start gap-3 rounded-2xl border border-amber-300 bg-amber-50 p-4 text-sm text-amber-700",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:b=>h(b.target.checked),className:"mt-1 h-4 w-4 rounded border-amber-300 bg-white"}),"Entendo que v√≠deos na horizontal podem n√£o ficar bons no resultado final."]}),e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Nota escrita (opcional)"}),e.jsx("button",{className:"text-sm text-rose-500",onClick:m,children:o?"Ocultar":"Adicionar"})]}),o&&e.jsx("textarea",{value:c,onChange:b=>u(b.target.value),placeholder:`Se quiser, deixe uma frase curta‚Ä¶ ${d}`,className:"w-full min-h-24 rounded-xl border border-rose-100 bg-rose-50/40 p-3 text-sm text-slate-700 placeholder:text-slate-400",maxLength:240})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{className:"w-full rounded-2xl bg-rose-100 text-rose-700 py-4 text-lg font-semibold",onClick:p,children:"üîÅ Gravar novamente"}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold",onClick:C,children:"üöÄ Enviar v√≠deo"})]})]})}function Re({name:t,relation:s,onNameChange:n,onRelationChange:c,onContinue:o,onBack:d}){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Antes de enviar"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Seu v√≠deo ficar√° identificado com seu nome e rela√ß√£o com o casal."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-slate-600",children:"Nome"}),e.jsx("input",{value:t,onChange:l=>n(l.target.value),placeholder:"Seu nome",className:"w-full rounded-2xl border border-rose-200 bg-white p-4 text-base text-slate-900"}),e.jsx("label",{className:"text-sm text-slate-600",children:"Rela√ß√£o (opcional)"}),e.jsx("input",{value:s,onChange:l=>c(l.target.value),placeholder:"ex: amiga da faculdade",className:"w-full rounded-2xl border border-rose-200 bg-white p-4 text-base text-slate-900"}),e.jsx("p",{className:"text-xs text-slate-500",children:"exemplos: amiga da faculdade ¬∑ primo ¬∑ colega de trabalho"})]}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold",onClick:o,children:"Continuar"}),e.jsx("button",{className:"w-full rounded-2xl border border-rose-200 py-3 text-rose-600",onClick:d,children:"Voltar"})]})}function Ie({name:t,relation:s,isSubmitting:n,onEdit:c,onSubmit:o}){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-4 text-sm text-slate-700",children:["Esse v√≠deo ser√° identificado como:",e.jsxs("strong",{className:"block text-base text-slate-900 mt-2",children:[t||"Seu nome"," ‚Äî ",s||"sem rela√ß√£o informada"]})]}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-100 text-rose-700 py-3",onClick:c,children:"Editar informa√ß√µes"}),e.jsx("button",{className:"w-full rounded-2xl bg-rose-500 text-white py-4 text-lg font-semibold disabled:opacity-60",onClick:o,disabled:n,children:n?"Enviando‚Ä¶":"Enviar v√≠deo"})]})}function Oe({slides:t,activeIndex:s,showVideo:n,onPrev:c,onNext:o,onFinish:d}){const l=t[s],m=s===t.length-1;return n?e.jsx("section",{className:"space-y-6",children:e.jsx("div",{className:"rounded-3xl border border-rose-100 bg-white p-4 shadow-sm",children:e.jsx("video",{src:"/assets/video_mary_rodando.mp4",controls:!0,playsInline:!0,className:"w-full rounded-2xl bg-rose-50",autoPlay:!0})})}):e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"relative overflow-hidden rounded-3xl border border-rose-100 bg-white shadow-sm",children:e.jsx("div",{className:"h-72 w-full bg-linear-to-br from-rose-200 via-white to-pink-100 flex items-center justify-center",children:e.jsx("img",{src:l.path,alt:l.title,className:"object-cover h-full w-full"})})}),e.jsxs("div",{className:"rounded-2xl border border-rose-100 bg-white p-5 space-y-3 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold",children:l.title}),e.jsx("p",{className:"text-sm text-slate-600",children:l.description})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{className:"rounded-2xl border border-rose-200 px-4 py-2 text-rose-600 disabled:opacity-40",onClick:c,disabled:s===0,children:"Voltar"}),e.jsx("div",{className:"flex items-center gap-2",children:t.map((u,h)=>e.jsx("span",{className:`h-2 w-2 rounded-full ${h===s?"bg-rose-500":"bg-rose-200"}`},u.id))}),e.jsx("button",{className:"rounded-2xl bg-rose-500 px-5 py-2 text-white",onClick:m?d:o,children:m?"Fim":"Pr√≥ximo"})]})]})}function Ue({message:t}){return e.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700",children:t})}export{_e as component};
